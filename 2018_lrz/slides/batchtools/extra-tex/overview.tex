  \tikzstyle{box} = [rectangle, drop shadow, draw=black, fill=white, thick, minimum width=4cm, rounded corners, align=center,font=\ttfamily\large]
  \tikzstyle{chead} = [font=\large\bfseries]
  \tikzstyle{rhead} = [chead,align=left, minimum width=4cm]
  \tikzstyle{bg} = [rectangle, fill=gray!10, inner sep=0.2cm, rounded corners=5mm]
  \tikzstyle{hl} = [rectangle, draw=red, inner sep=0.2cm, rounded corners=5mm]

  \matrix [row sep=10mm, column sep=5mm] (mat) {
    \node (chead0) [minimum width=4cm] {}; \pgfmatrixnextcell
    \node (chead1) [chead] {BatchJobs' functions}; \pgfmatrixnextcell
    \node (chead2) [chead] {Common functions}; \pgfmatrixnextcell
    \node (chead3) [chead] {BatchExperiments' functions}; \\

    \node (registry0) [rhead] {(1) Create Registry}; \pgfmatrixnextcell
    \node (registry1) [box] {makeRegistry}; \pgfmatrixnextcell
    \node (registry2) {}; \pgfmatrixnextcell
    \node (registry3) [box] {makeExperimentRegistry}; \\

    \node (define0) [rhead] {(2) Define Jobs}; \pgfmatrixnextcell
    \node (define1) [box] {batchMap \\ batchReduce \\ batchExpandGrid}; \pgfmatrixnextcell
    \node (define2) [box] {batchMapResults \\ batchReduceResults}; \pgfmatrixnextcell
    \node (define3) [box] {addProblem \\ addAlgorithm \\ makeDesign \\ addExperiments}; \\

    \node (subsetting0) [rhead] {(3) Subset Jobs}; \pgfmatrixnextcell
    \node (subsetting1) [box] {findJobs}; \pgfmatrixnextcell
    \node (subsetting2) [box] {findDone\\ findErrors \\\ldots}; \pgfmatrixnextcell
    \node (subsetting3) [box] {findExperiments}; \\

    \node (submit0) [rhead] {(4) Submit Jobs}; \pgfmatrixnextcell
    \node (submit1) {}; \pgfmatrixnextcell
    \node (submit2) [box] {submitJobs}; \pgfmatrixnextcell
    \node (submit3) {}; \\

    \node (status0) [rhead] {(5) Status \& Debugging}; \pgfmatrixnextcell
    \node (status1) {}; \pgfmatrixnextcell
    \node (status2) [box] {showStatus \\ testJob \\ showLog}; \pgfmatrixnextcell
    \node (status3) [box] {summarizeExperiments}; \\

    \node (collect0) [rhead] {(6) Collect Results}; \pgfmatrixnextcell
    \node (collect1) {}; \pgfmatrixnextcell
    \node (collect2) [box] {loadResult[s] \\ reduceResults \\ filterResults \\ reduceResults[AggrType]}; \pgfmatrixnextcell
    \node (collect3) [box] {reduceResultsExperiments}; \\
  };
  \begin{pgfonlayer}{background}
    \node [bg, fit=(chead0) (collect0)] {};
    \node [bg, fit=(chead0) (chead3)] {};
  \end{pgfonlayer}
